<div class="dashboard-container">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-logo text-center mb-4">
      <img src="/img/ford.png" alt="Ford Logo" class="img-fluid" style="max-width: 80px;">
    </div>
    <div class="sidebar-header">
      <h3>Menu</h3>
    </div>
    <ul class="sidebar-menu">
      <li><a routerLink="/home" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">Home</a></li>
      <li><a routerLink="/dashboard" routerLinkActive="active">Dashboard</a></li>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Header -->
    <div class="header d-flex justify-content-between align-items-center">
      <h1>Dashboard FORD</h1>
      <div class="header-buttons">
        <button class="btn btn-outline-danger" (click)="logout()">
          <i class="fas fa-sign-out-alt me-2"></i>Logout
        </button>
      </div>
    </div>

<!-- Main Content Row -->
<div class="row g-3">
  <!-- Vehicle Selector -->
  <div class="col-md-3">
    <div class="card h-100">
      <div class="card-body">
        <h5 class="card-title">Veículo</h5>
        <select
          class="form-select"
          [(ngModel)]="selectedVehicle"
          (ngModelChange)="onVehicleSelect()"
          id="vehicleSelect">
          <option value="">Selecione um veículo...</option>
          <option *ngFor="let vehicle of vehicles" [ngValue]="vehicle">
            {{ vehicle.modelo }}
          </option>
        </select>
      </div>
    </div>
  </div>

  <!-- Vehicle Image -->
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-body text-center">
        <img
          *ngIf="selectedVehicle"
          [src]="'/img/' + selectedVehicle.imagem"
          [alt]="'Veículo ' + selectedVehicle.modelo"
          class="card-img"
          [title]="selectedVehicle.modelo"
          (error)="onImageError($event)"
        >
      </div>
    </div>
  </div>

  <!-- Statistics -->
  <div class="col-md-3">
    <div class="card h-100">
      <div class="card-body">
        <div class="row g-2">
          <div class="col-12">
            <h5 class="card-title">Total de Vendas</h5>
            <p class="card-text fw-bold">{{ stats.totalVendas }}</p>
          </div>
          <div class="col-12">
            <h5 class="card-title">Conectados</h5>
            <p class="card-text fw-bold">{{ stats.veiculosConectados }}</p>
          </div>
          <div class="col-12">
            <h5 class="card-title">Update Software</h5>
            <p class="card-text fw-bold">{{ stats.veiculosAtualizados }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Status Bar -->
<div class="status-bar" *ngIf="selectedVehicle">
  <div class="row g-2">
    <div class="col">
      <strong>Código - VIN</strong>
      {{ selectedVehicle.codigo || '9F7H0U3Y2K1NH027455' }}
    </div>
    <div class="col">
      <strong>Odômetro</strong>
      {{ selectedVehicle.odometro || '50000 Km' }}
    </div>
    <div class="col">
      <strong>Nível de Combustível</strong>
      {{ selectedVehicle.nivelCombustivel || '90%' }}
    </div>
    <div class="col">
      <strong>Status</strong>
      <span [class]="selectedVehicle.status === 'Conectado' ? 'text-success' : 'text-danger'">
        {{ selectedVehicle.status || 'Desconectado' }}
      </span>
    </div>
    <div class="col">
      <strong>Lat.</strong>
      {{ selectedVehicle.latitude || '-12.2222' }}
    </div>
    <div class="col">
      <strong>Long.</strong>
      {{ selectedVehicle.longitude || '-35.2144' }}
    </div>
  </div>
</div>

<!-- Vehicle Data Table - Only show when vehicle is selected -->
<div class="card mt-4" *ngIf="selectedVehicle">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="card-title mb-0">Dados dos Veículos</h5>
    <div class="search-box d-flex">
      <input
        type="text"
        class="form-control"
        [(ngModel)]="searchCode"
        (ngModelChange)="onSearchChange($event)"
        placeholder="Buscar por código VIN..."
        style="max-width: 300px;">
      <button
        type="button"
        class="btn btn-outline-secondary ms-2"
        (click)="clearSearch()"
        title="Limpar busca">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Código VIN</th>
            <th>Modelo</th>
            <th>Ano</th>
            <th>Cor</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let vehicle of filteredData" class="table-row">
            <td>{{ vehicle.codigo || 'N/A' }}</td>
            <td>{{ vehicle.modelo || 'N/A' }}</td>
            <td>{{ vehicle.ano || 'N/A' }}</td>
            <td>
              <span class="badge bg-primary">{{ vehicle.cor || 'N/A' }}</span>
            </td>
            <td>
              <span class="badge bg-success" *ngIf="vehicle.status === 'Conectado'">{{ vehicle.status }}</span>
              <span class="badge bg-danger" *ngIf="vehicle.status === 'Desconectado'">{{ vehicle.status }}</span>
              <span class="badge bg-secondary" *ngIf="!vehicle.status">Offline</span>
            </td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="filteredData.length === 0" class="no-data text-center py-4">
        <p class="mb-2">Nenhum veículo encontrado com os critérios de busca.</p>
        <i class="fas fa-search fa-2x text-muted"></i>
      </div>
    </div>
  </div>
  </div>
</div>
